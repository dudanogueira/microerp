{% extends "frontend/frontend-base.html" %}
{% load sekizai_tags %}

<title>{%block title %}{{block.super}} - Início - Ocorrências{% endblock %}</title>

{% block content %}
<h1><i class="icon-th"></i> <i class="icon icon-bell"></i> Minhas Ocorrências</h1>

{% if ocorrencias_correcao %}
    <h2><i class="icon-beaker"></i> Em Análise</h2>
    <h3><i class="icon-wrench"></i> Correção</h3>
    {% for ocorrencia in ocorrencias_correcao %}
    <div class="well well-small">

        <div class="row-fluid">

            <div class="span7">
                <h4><i class="icon-bell icon-1x"></i><strong>#{{ocorrencia.id}} {{ocorrencia.reclamante}}</strong></h4>
                <i class="icon-tag"></i> {{ocorrencia.get_prioridade_display}}
                <p>
                    {% if not ocorrencia.correcao_iniciada %}
                    <hr />
                    <a href="{% url "minhas_ocorrencias_abrir_correcao" ocorrencia.id %}" class="btn btn-danger"><i class="icon-wrench icon-2x"></i> Corrigir</a>
                    
                    {% else %}
                    <a href="{% url "minhas_ocorrencias_resolvido" ocorrencia.id %}" class="btn btn-primary">Marcar como Resolvido</a>
                    <button class="btn btn-success">Inserir Interação</button>
                    {% endif %}
                </p>
                <p><a href="#" class="btn danger" rel="popover" data-placement="top" data-toggle="popover" data-html="true" data-trigger="hover" data-content='{% include "frontend/ocorrencia/ocorrencia-historico-entrada.html" %}' data-original-title="Histórico de Entrada"><i class="icon-time"></i> Histórico de Entrada</a></p>
            </div>
    
            <div class="span5">
                <h5>Descrição</h5>
                <p class="alert alert-info">{{ocorrencia.descricao}}</p>
                <h5>Providência</h5>
                <p class="alert alert-success">
                    {{ocorrencia.providencia}}<br />
                    <small><strong>despachado por {{ocorrencia.despachado_por.funcionario}}</strong></small>  
                </p>  
            </div>
    
        </div>

    </div>
    {% endfor %}
{% endif %}

{% if ocorrencias_contato %}
    <h2><i class="icon-phone"></i> Em Contato</h2>
    <h3><i class="icon-circle"></i> Ponto de Contato</h3>
    {% for ocorrencia in ocorrencias_contato %}
    <div class="well">
    
        <div class="row-fluid">
            
                {% if ocorrencia.procede %}
                <div class="span2 alert alert-info">
                    <div class="">
                        <h3><strong class="pull-left">#{{ocorrencia.id}}</strong></h3> <i class="icon-thumbs-up icon-2x pull-right"></i>
                    </div>    
                </div>
                {% else %}
                <div class="span2 alert alert-danger">
                    <h3><strong class="pull-left">#{{ocorrencia.id}}</strong></h3> <i class="icon-thumbs-down icon-2x pull-right"></i><br />
                </div>    
                {% endif %}
            
            <div class="span8 text-center">
                <h4> {{ocorrencia.reclamante}}</strong></h4>
                <p >Contato: {{ocorrencia.contato_principal|join:","}}<br />
                    
<a href="#" class="btn danger" rel="popover" data-placement="top" data-toggle="popover" data-html="true" data-trigger="hover" data-content='{% include "frontend/ocorrencia/ocorrencia-historico-entrada.html" %}' data-original-title="Histórico de Entrada"><i class="icon-time"></i> Histórico de Entrada</a>
                
            </div>
        
            <div class="span2">
                <a href="{% url "minhas_ocorrencias_fechar_contato" ocorrencia.id %}" class="btn btn-large btn-primary pull-right"><i class="icon-phone"></i> Fechar Contato</a>
            </div>
        
        </div>
        
        <div class="row-fluid">
  
            <div class="span4">
                <div class="alert alert-info">
                    <h5><i class="icon-comments icon-1x"></i> Ocorrência</h5>
                    {{ocorrencia.descricao}}<br />
                    <small><strong><i class="icon-plus"></i> em {{ocorrencia.criado|date:"SHORT_DATETIME_FORMAT"}}</strong></small>
                </div>
            </div>    
  
            <div class="span4">
                {% if ocorrencia.procede %}
                <div class="alert alert-warning">
                    <h5><i class="icon-umbrella icon-1x"></i> Providência</h5>
                    {{ocorrencia.providencia}}<br />
                    <small><strong><i class="icon-bullhorn"></i> em {{ocorrencia.despachado_data|date:"SHORT_DATETIME_FORMAT"}}<br />por {{ocorrencia.despachado_por.funcionario}} </strong>
                    </small><br />
                    <small><strong><i class="icon-wrench"></i> em {{ocorrencia.correcao_iniciada|date:"SHORT_DATETIME_FORMAT"}}<br />por {{ocorrencia.responsavel_correcao}} </strong>
                    </small>
                </div>
                {% else %}
                
                <div class="alert alert-danger">
                    <h5><i class="icon-thumbs-down icon-4x"></i> Improcedente</h5>
                    {{ocorrencia.nao_procede_porque}}<br />
                    <strong>{% if ocorrencia.despachado_por.funcionario %}<i class="icon-thumbs-up"></i>em {{ocorrencia.despachado_data|date:"SHORT_DATETIME_FORMAT"}}
                        por {{ocorrencia.despachado_por.funcionario}}{% endif %}{% if ocorrencia.despachado_data %} 
                        {% endif %}</strong>
                </div>
                
                {% endif %}
      
            </div>    
  
  
            <div class="span4">
                {% if ocorrencia.procede %}
                <div class="alert alert-success">
                    <h5><i class="icon-check icon-1x"></i> Resolução</h5>
                    {{ocorrencia.resolucao_final}}<br />
                    <small><strong><i class="icon-thumbs-up"></i> em {{ocorrencia.resolucao_final_data|date:"SHORT_DATETIME_FORMAT"}} por {{ocorrencia.responsavel_correcao}} </strong></small>
                </div>
                {% endif %}
      
            </div>    
  
        </div>          
    </div>
    {% endfor %}
{% endif %}

{% if ocorrencias_visto %}
    <h3><i class="icon-check"></i> Visto</h3>
    {% for ocorrencia in ocorrencias_visto %}
    <div class="well well-small">
    
        <div class="row-fluid">
        
            <div class="span10">
                <h5>#{{ocorrencia.id}} {{ocorrencia.reclamante}}</h5>
            
                <div class="row-fluid">
  
                    <div class="span4">
                        <div class="alert alert-info">
                            <h5><i class="icon-comments icon-1x"></i> Ocorrência</h5>
                            {{ocorrencia.descricao}}<br />
                            <strong>{{ocorrencia.criado|date:"SHORT_DATETIME_FORMAT"}}</strong>
                        </div>
      
                    </div>    
  
                    <div class="span4">
                        {% if ocorrencia.procede %}
                            <div class="alert alert-warning">
                            <h5><i class="icon-umbrella icon-1x"></i> Providência</h5>
                            {{ocorrencia.providencia}}<br />
                            <small><strong>por {{ocorrencia.despachado_por.funcionario}} em {{ocorrencia.despachado_data|date:"SHORT_DATETIME_FORMAT"}}</strong></small>
  
                        </div>
                        {% else %}
                        <div class="well well-small alert-danger">
                        <h5><i class="icon-thumbs-down icon-2x"></i> Motivo de Improcedência</h5>
                        {{ocorrencia.nao_procede_porque}}<br />
                        <small><strong>por {{ocorrencia.despachado_por.funcionario}} em {{ocorrencia.despachado_data|date:"SHORT_DATETIME_FORMAT"}}</strong></small>

                    </div>
                        {% endif %}
      
                    </div>    
  
  
                    <div class="span4">
                        <div class="alert alert-success">
                            <h5><i class="icon-check icon-1x"></i> Resolução</h5>
                            {{ocorrencia.resolucao_final}}<br />
                            <small><strong>por {{ocorrencia.responsavel_correcao}} em {{ocorrencia.despachado_data|date:"SHORT_DATETIME_FORMAT"}}</strong></small>
  
                        </div>
      
                    </div>    
  
                </div>          
            
            </div>
        
            <div class="span2">
                <a href="{% url "minhas_ocorrencias_fechar_visto" ocorrencia.id %}" class="btn btn-success"><i class="icon-check icon-2x"></i></a>
                <a class="btn btn-danger"><i class="icon-remove icon-2x"></i></a>
            </div>
        
        
        </div>
    
    </div>
    {% endfor %}
{% endif %}


    {% endblock %}

    {% block auxiliar-menu %}
    {% addtoblock "js" %}
    <script>
    $(document).ready(function() {
        $("#main-home-minhas-ocorrencias, #top-menu-home").addClass("active");
        $("a[data-toggle=popover]")
              .popover()
              .click(function(e) {
                e.preventDefault()
              })
    });
    </script>
    {% endaddtoblock %}


    {% endblock %}
