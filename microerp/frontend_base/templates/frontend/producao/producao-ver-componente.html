{% extends "frontend/frontend-base.html" %}
{% load sekizai_tags %}

<title>{%block title %}{{block.super}} - Produção - Editar Nota Fiscal{% endblock %}</title>

{% block content %}
<h1>Componente {{componente.part_number}}</h1>

<ul class="nav nav-tabs">
  <li class="active"><a href="#valores" data-toggle="tab">Valores</a></li>
<li><a href="#participacao" data-toggle="tab">Participações</a></li>
  <li><a href="#fornecimento" data-toggle="tab">Fornecimento</a></li>
  <li><a href="#fabricacao" data-toggle="tab">Fabricação</a></li>
  <li><a href="#memoria" data-toggle="tab">Memória</a></li>
  <li><a href="#arquivos" data-toggle="tab">Arquivos Anexos</a></li>
  
</ul>
{% if componente.imagem %}
<p>
<a href="{{componente.imagem.url}}"><img src="{{componente.imagem.url}}"></a>
</p>
{% endif %}

<div id="myTabContent" class="tab-content">
    
    
    
        <div class="tab-pane fade in active" id="valores">
            
            <div class="row-fluid">
                
                <div class="span6">
                    
                    <div class="well well-small">
                        <h6>Valores da última compra:</h6>
                        {% if componente.preco_liquido_unitario_dolar %}
                        <strong>Preço Líquido Unitário em Dólar</strong>: USD {{componente.preco_liquido_unitario_dolar}}<br />
                        {% endif %}
                        {% if componente.preco_liquido_unitario_real %}
                        <strong>Preço Líquido Unitário em Real</strong>: R$ {{componente.preco_liquido_unitario_real}}<br />
                        {% endif %}
                        {% if componente.preco_medio_unitario %}
                        <strong>Preço Médio Bruto Unitário</strong>: R$ {{componente.preco_medio_unitario}}
                        {% endif %}        
                    </div>
        

                    
                </div>
                <div class="span6">
                    <div class="well well-small">
                        <h6>Posições em Estoque</h6>
                        <table class="table table-condensed table-striped table-rounded">
                            <thead>
                                <tr>
                                    <th>Estoque</th>
                                    <th>Quantidade</th>
                                    <th>Data</th>
                                </tr>
                            </thead>
                            </tbody>
                            {% for posicao in posicoes_estoque %}
                            <tr>
                                <td>{% if posicao.estoque.nome %}{{posicao.estoque.nome}}{% else %}{{posicao.estoque}}{% endif %}</td>
                                <td>{{posicao.quantidade}}</td>
                                <td>{{posicao.criado|date:"SHORT_DATETIME_FORMAT"}}</td>
                            </tr>
                            {% endfor %}

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <h4>Histórico de Valores Lançados</h4>
            <div class="row-fluid">
                <div class="span12">
                    <h6>Gráfico R$ X Lançamento
                    <canvas id="canvas" height="300px" width=""></canvas>
                </div>
    
            </div>
            
            
        </div>
        
        <div class="tab-pane fade in" id="fornecimento">
            <h3>Fornecedores - Unidades fornecidas</h3>
            {% for fornecedor in fornecedores %}
            <strong>{{fornecedor.nota__fabricante_fornecedor__nome}}</strong>: {{fornecedor.total}} {{componente.get_medida_display}}{{fornecedor.total|pluralize}}<br />
            {% empty %}
                Nenhum Item Fornecido
            {% endfor %}
            
            <h3>Lançamentos Fornecidos</h3>
            {% for lancamento in lancamentos %}
            <span class="label label-info">+ {{lancamento.quantidade}} {{lancamento.componente.medida}}</span> em  {{lancamento.nota.data_lancado_estoque|date:"SHORT_DATETIME_FORMAT"}} <span class="label label-success"><strong>Fornecedor: {{lancamento.nota.fabricante_fornecedor.nome}} ({{lancamento.part_number_fornecedor}})</strong></span>, <span class="label label-warning">Fabricante: {{lancamento.fabricante.nome}} - {{lancamento.part_number_fabricante}}</span> nota: {{lancamento.nota.numero}}. <strong>Por: {{lancamento.nota.lancado_por.funcionario}}</strong><br />
            <hr />
            {% empty %}
                Nenhum Lançamento Realizado
            {% endfor %}
            
        </div>
        
        <div class="tab-pane fade in" id="fabricacao">
            <h3>Fabricantes - Unidades fabricadas</h3>
            {% for fabricante in fabricantes %}
            <strong>{{fabricante.fabricante__nome}}</strong>: {{fabricante.total}} {{componente.get_medida_display}}{{fabricante.total|pluralize}}<br />
            {% empty %}
                Nenhuma Fabricação Indicada em Lançamento
            
            {% endfor %}
            
        </div>
        
        <div class="tab-pane fade in" id="participacao">
            Participação
        </div>
        
        <div class="tab-pane fade in" id="memoria">


            <h4>Memória de Relacionamento com Fornecedores</h4>
            {% if request.user.perfilacessoproducao.gerente %}
            <p>
                <a href="{% url "producao:adicionar_memoria_componente" componente.id %}" class="btn btn-primary"><i class="icon-plus"></i> Adicionar à Memória</a>
            </p>
            {% endif %}
            <div class="well well-small">
                <ul>

                {% for memoria in memorias %}
                    <li>
                        <a href="{% url "producao:ver_fabricantes_fornecedores" memoria.fornecedor.id %}">
                            {{memoria.fornecedor.nome_curto}}
                        </a>:
                        <span class="label label-warning">
                            PNFOR: {{memoria.part_number_fornecedor}}
                        </span>
                        ->
                        <span class="label label-success">
                            <em>{{memoria.componente.part_number}}</em>
                        </span>
                        <span class="label label-info">
                            FAB: {{memoria.fabricante.nome}}
                        </span>
                        <span class="label label-info">
                            PNFAB: {{memoria.part_number_fabricante}}
                        </span>
                        
                        {% if request.user.perfilacessoproducao.gerente %}
                        <a href="{% url "producao:apagar_memoria_componente" memoria.componente.pk memoria.pk %}" class="btn btn-danger">
                            <i class="icon-trash"></i> Apagar
                        </a>{% endif %}
                    </li>
                {% empty %}
                    <p>Este Fornecedor Não possui memória de entrada de lançamentos de nota fiscal</p>
                {% endfor %}
                </ul>

            </div>

        
        </div>
        
        <div class="tab-pane fade in" id="arquivos">

            {% if request.user.perfilacessoproducao.gerente %}
            <form method="POST" class="form-horizontal" action="#anexos" enctype="multipart/form-data">
                {% csrf_token %}
                {{form_anexos}}
                <button class="btn btn-primary" name="anexar-documento" value="anexar" type="submit"><i class="icon-paperclip"></i> Anexar Arquivo</button>
                
            </form>
            {% endif %}
            <hr />
            {% for anexo in componente.arquivoanexocomponente_set.all %}
            <span class="label label-info">{{forloop.counter}}</span> - <a href="{{anexo.arquivo.url}}">{{anexo.arquivo}}</a>
            <hr />
            {% empty %}
            Nenhum arquivo anexo.
            {% endfor %}
        </div>
        
</div>






{% endblock %}

{% block auxiliar-menu %}
{% addtoblock "js" %}
<script src="{{STATIC_URL}}frontend/js/Chart.min.js"></script>
<script>
$(document).ready(function() {
	$("#menu-producao-componentes, #top-menu-producao").addClass("active");
    $("#busca_componente").focus()
   var activeTab = $('[href=' + location.hash + ']');
   activeTab && activeTab.tab('show');
    
});
</script>


<script>

	var lineChartData = {
		labels : [{% for lancamento in lancamentos %}"{{lancamento.criado|date:"SHORT_DATE_FORMAT"}}",{% endfor %}
],
		datasets : [
			{
				fillColor : "rgba(53,150,159,0.5)",
				strokeColor : "rgba(220,220,220,1)",
				pointColor : "rgba(220,220,220,1)",
				pointStrokeColor : "#fff",
				data : [{% for lancamento in lancamentos %}{{lancamento.valor_unitario_final}},{% endfor %}
]
			},
		]
		
	}

var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Line(lineChartData);

</script>

{% endaddtoblock %}
{% include "frontend/producao/producao-menu.html" %}
{% endblock%}